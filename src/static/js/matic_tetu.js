$(function () {
    consoleInit(main)
});

const CONTRACT_READER_ABI = [{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"newValue","type":"address"}],"name":"ToolAddressUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"oldValue","type":"address"},{"indexed":false,"internalType":"address","name":"newValue","type":"address"}],"name":"UpdateController","type":"event"},{"inputs":[],"name":"PRECISION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"VERSION","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"bookkeeper","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tvl","type":"uint256"},{"internalType":"uint256","name":"rewards","type":"uint256"},{"internalType":"uint256","name":"duration","type":"uint256"}],"name":"computeApr","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"pure","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"},{"internalType":"address","name":"rt","type":"address"}],"name":"computeRewardApr","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"controller","outputs":[{"internalType":"address","name":"adr","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"created","outputs":[{"internalType":"uint256","name":"ts","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_token","type":"address"}],"name":"getPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_controller","type":"address"}],"name":"initialize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_controller","type":"address"}],"name":"initializeControllable","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_adr","type":"address"}],"name":"isController","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_adr","type":"address"}],"name":"isGovernance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"priceCalculator","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"newValue","type":"address"}],"name":"setPriceCalculator","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"strategies","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"strategiesLength","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_strategy","type":"address"}],"name":"strategyAssets","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_strategy","type":"address"}],"name":"strategyCreated","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_strategy","type":"address"}],"name":"strategyEarned","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_strategy","type":"address"}],"name":"strategyPausedInvesting","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_strategy","type":"address"}],"name":"strategyPlatform","outputs":[{"internalType":"enum IStrategy.Platform","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_strategy","type":"address"}],"name":"strategyRewardTokens","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"tetuTokenValues","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address[]","name":"_vaults","type":"address[]"}],"name":"totalTetuBoughBack","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address[]","name":"_vaults","type":"address[]"}],"name":"totalTvlUsdc","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"address","name":"_vault","type":"address"}],"name":"userDepositedShare","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"address","name":"_vault","type":"address"}],"name":"userDepositedUnderlying","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"address","name":"_vault","type":"address"}],"name":"userDepositedUnderlyingUsdc","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"address","name":"_vault","type":"address"}],"name":"userInfo","outputs":[{"components":[{"internalType":"address","name":"wallet","type":"address"},{"internalType":"address","name":"vault","type":"address"},{"internalType":"uint256","name":"underlyingBalance","type":"uint256"},{"internalType":"uint256","name":"underlyingBalanceUsdc","type":"uint256"},{"internalType":"uint256","name":"depositedUnderlying","type":"uint256"},{"internalType":"uint256","name":"depositedUnderlyingUsdc","type":"uint256"},{"internalType":"uint256","name":"depositedShare","type":"uint256"},{"internalType":"address[]","name":"rewardTokens","type":"address[]"},{"internalType":"uint256[]","name":"rewards","type":"uint256[]"},{"internalType":"uint256[]","name":"rewardsUsdc","type":"uint256[]"},{"internalType":"uint256[]","name":"rewardsEarned","type":"uint256[]"}],"internalType":"struct ContractReader.UserInfo","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"address","name":"_vault","type":"address"}],"name":"userInfoLight","outputs":[{"components":[{"internalType":"uint256","name":"depositedUnderlying","type":"uint256"},{"internalType":"uint256","name":"depositedUnderlyingUsdc","type":"uint256"},{"internalType":"uint256","name":"depositedShare","type":"uint256"}],"internalType":"struct ContractReader.UserInfoLight","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"address[]","name":"_vaults","type":"address[]"}],"name":"userInfosLight","outputs":[{"components":[{"internalType":"uint256","name":"depositedUnderlying","type":"uint256"},{"internalType":"uint256","name":"depositedUnderlyingUsdc","type":"uint256"},{"internalType":"uint256","name":"depositedShare","type":"uint256"}],"internalType":"struct ContractReader.UserInfoLight[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"address","name":"_vault","type":"address"}],"name":"userRewards","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"address","name":"_vault","type":"address"}],"name":"userRewardsUsdc","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"address","name":"_vault","type":"address"}],"name":"userUnderlyingBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"address","name":"_vault","type":"address"}],"name":"userUnderlyingBalanceUsdc","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"}],"name":"vaultActive","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"}],"name":"vaultCreated","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"}],"name":"vaultDecimals","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"}],"name":"vaultDuration","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"vault","type":"address"}],"name":"vaultInfo","outputs":[{"components":[{"internalType":"address","name":"addr","type":"address"},{"internalType":"string","name":"name","type":"string"},{"internalType":"uint256","name":"created","type":"uint256"},{"internalType":"bool","name":"active","type":"bool"},{"internalType":"uint256","name":"tvl","type":"uint256"},{"internalType":"uint256","name":"tvlUsdc","type":"uint256"},{"internalType":"uint256","name":"decimals","type":"uint256"},{"internalType":"address","name":"underlying","type":"address"},{"internalType":"address[]","name":"rewardTokens","type":"address[]"},{"internalType":"uint256[]","name":"rewardTokensBal","type":"uint256[]"},{"internalType":"uint256[]","name":"rewardTokensBalUsdc","type":"uint256[]"},{"internalType":"uint256","name":"duration","type":"uint256"},{"internalType":"uint256[]","name":"rewardsApr","type":"uint256[]"},{"internalType":"uint256","name":"ppfsApr","type":"uint256"},{"internalType":"uint256","name":"users","type":"uint256"},{"internalType":"address","name":"strategy","type":"address"},{"internalType":"uint256","name":"strategyCreated","type":"uint256"},{"internalType":"enum IStrategy.Platform","name":"platform","type":"uint8"},{"internalType":"address[]","name":"assets","type":"address[]"},{"internalType":"address[]","name":"strategyRewards","type":"address[]"},{"internalType":"bool","name":"strategyOnPause","type":"bool"},{"internalType":"uint256","name":"earned","type":"uint256"}],"internalType":"struct ContractReader.VaultInfo","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"vault","type":"address"}],"name":"vaultInfoLight","outputs":[{"components":[{"internalType":"address","name":"addr","type":"address"},{"internalType":"uint256","name":"created","type":"uint256"},{"internalType":"bool","name":"active","type":"bool"},{"internalType":"uint256","name":"tvl","type":"uint256"},{"internalType":"uint256","name":"tvlUsdc","type":"uint256"},{"internalType":"address","name":"underlying","type":"address"},{"internalType":"address[]","name":"rewardTokens","type":"address[]"},{"internalType":"uint256[]","name":"rewardsApr","type":"uint256[]"},{"internalType":"uint256","name":"ppfsApr","type":"uint256"},{"internalType":"enum IStrategy.Platform","name":"platform","type":"uint8"},{"internalType":"address[]","name":"assets","type":"address[]"},{"internalType":"uint256","name":"earned","type":"uint256"}],"internalType":"struct ContractReader.VaultInfoLight","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address[]","name":"_vaults","type":"address[]"}],"name":"vaultInfos","outputs":[{"components":[{"internalType":"address","name":"addr","type":"address"},{"internalType":"string","name":"name","type":"string"},{"internalType":"uint256","name":"created","type":"uint256"},{"internalType":"bool","name":"active","type":"bool"},{"internalType":"uint256","name":"tvl","type":"uint256"},{"internalType":"uint256","name":"tvlUsdc","type":"uint256"},{"internalType":"uint256","name":"decimals","type":"uint256"},{"internalType":"address","name":"underlying","type":"address"},{"internalType":"address[]","name":"rewardTokens","type":"address[]"},{"internalType":"uint256[]","name":"rewardTokensBal","type":"uint256[]"},{"internalType":"uint256[]","name":"rewardTokensBalUsdc","type":"uint256[]"},{"internalType":"uint256","name":"duration","type":"uint256"},{"internalType":"uint256[]","name":"rewardsApr","type":"uint256[]"},{"internalType":"uint256","name":"ppfsApr","type":"uint256"},{"internalType":"uint256","name":"users","type":"uint256"},{"internalType":"address","name":"strategy","type":"address"},{"internalType":"uint256","name":"strategyCreated","type":"uint256"},{"internalType":"enum IStrategy.Platform","name":"platform","type":"uint8"},{"internalType":"address[]","name":"assets","type":"address[]"},{"internalType":"address[]","name":"strategyRewards","type":"address[]"},{"internalType":"bool","name":"strategyOnPause","type":"bool"},{"internalType":"uint256","name":"earned","type":"uint256"}],"internalType":"struct ContractReader.VaultInfo[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address[]","name":"_vaults","type":"address[]"}],"name":"vaultInfosLight","outputs":[{"components":[{"internalType":"address","name":"addr","type":"address"},{"internalType":"uint256","name":"created","type":"uint256"},{"internalType":"bool","name":"active","type":"bool"},{"internalType":"uint256","name":"tvl","type":"uint256"},{"internalType":"uint256","name":"tvlUsdc","type":"uint256"},{"internalType":"address","name":"underlying","type":"address"},{"internalType":"address[]","name":"rewardTokens","type":"address[]"},{"internalType":"uint256[]","name":"rewardsApr","type":"uint256[]"},{"internalType":"uint256","name":"ppfsApr","type":"uint256"},{"internalType":"enum IStrategy.Platform","name":"platform","type":"uint8"},{"internalType":"address[]","name":"assets","type":"address[]"},{"internalType":"uint256","name":"earned","type":"uint256"}],"internalType":"struct ContractReader.VaultInfoLight[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"}],"name":"vaultName","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"}],"name":"vaultPpfsApr","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"}],"name":"vaultPpfsLastApr","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"}],"name":"vaultRewardTokens","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"}],"name":"vaultRewardTokensBal","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"}],"name":"vaultRewardTokensBalUsdc","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"}],"name":"vaultRewardsApr","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"}],"name":"vaultTvl","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"}],"name":"vaultTvlUsdc","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"}],"name":"vaultUnderlying","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"}],"name":"vaultUsers","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"uint256","name":"page","type":"uint256"},{"internalType":"uint256","name":"pageSize","type":"uint256"}],"name":"vaultWithUserInfoPages","outputs":[{"components":[{"components":[{"internalType":"address","name":"addr","type":"address"},{"internalType":"string","name":"name","type":"string"},{"internalType":"uint256","name":"created","type":"uint256"},{"internalType":"bool","name":"active","type":"bool"},{"internalType":"uint256","name":"tvl","type":"uint256"},{"internalType":"uint256","name":"tvlUsdc","type":"uint256"},{"internalType":"uint256","name":"decimals","type":"uint256"},{"internalType":"address","name":"underlying","type":"address"},{"internalType":"address[]","name":"rewardTokens","type":"address[]"},{"internalType":"uint256[]","name":"rewardTokensBal","type":"uint256[]"},{"internalType":"uint256[]","name":"rewardTokensBalUsdc","type":"uint256[]"},{"internalType":"uint256","name":"duration","type":"uint256"},{"internalType":"uint256[]","name":"rewardsApr","type":"uint256[]"},{"internalType":"uint256","name":"ppfsApr","type":"uint256"},{"internalType":"uint256","name":"users","type":"uint256"},{"internalType":"address","name":"strategy","type":"address"},{"internalType":"uint256","name":"strategyCreated","type":"uint256"},{"internalType":"enum IStrategy.Platform","name":"platform","type":"uint8"},{"internalType":"address[]","name":"assets","type":"address[]"},{"internalType":"address[]","name":"strategyRewards","type":"address[]"},{"internalType":"bool","name":"strategyOnPause","type":"bool"},{"internalType":"uint256","name":"earned","type":"uint256"}],"internalType":"struct ContractReader.VaultInfo","name":"vault","type":"tuple"},{"components":[{"internalType":"address","name":"wallet","type":"address"},{"internalType":"address","name":"vault","type":"address"},{"internalType":"uint256","name":"underlyingBalance","type":"uint256"},{"internalType":"uint256","name":"underlyingBalanceUsdc","type":"uint256"},{"internalType":"uint256","name":"depositedUnderlying","type":"uint256"},{"internalType":"uint256","name":"depositedUnderlyingUsdc","type":"uint256"},{"internalType":"uint256","name":"depositedShare","type":"uint256"},{"internalType":"address[]","name":"rewardTokens","type":"address[]"},{"internalType":"uint256[]","name":"rewards","type":"uint256[]"},{"internalType":"uint256[]","name":"rewardsUsdc","type":"uint256[]"},{"internalType":"uint256[]","name":"rewardsEarned","type":"uint256[]"}],"internalType":"struct ContractReader.UserInfo","name":"user","type":"tuple"}],"internalType":"struct ContractReader.VaultWithUserInfo[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"uint256","name":"page","type":"uint256"},{"internalType":"uint256","name":"pageSize","type":"uint256"}],"name":"vaultWithUserInfoPagesLight","outputs":[{"components":[{"components":[{"internalType":"address","name":"addr","type":"address"},{"internalType":"uint256","name":"created","type":"uint256"},{"internalType":"bool","name":"active","type":"bool"},{"internalType":"uint256","name":"tvl","type":"uint256"},{"internalType":"uint256","name":"tvlUsdc","type":"uint256"},{"internalType":"address","name":"underlying","type":"address"},{"internalType":"address[]","name":"rewardTokens","type":"address[]"},{"internalType":"uint256[]","name":"rewardsApr","type":"uint256[]"},{"internalType":"uint256","name":"ppfsApr","type":"uint256"},{"internalType":"enum IStrategy.Platform","name":"platform","type":"uint8"},{"internalType":"address[]","name":"assets","type":"address[]"},{"internalType":"uint256","name":"earned","type":"uint256"}],"internalType":"struct ContractReader.VaultInfoLight","name":"vault","type":"tuple"},{"components":[{"internalType":"uint256","name":"depositedUnderlying","type":"uint256"},{"internalType":"uint256","name":"depositedUnderlyingUsdc","type":"uint256"},{"internalType":"uint256","name":"depositedShare","type":"uint256"}],"internalType":"struct ContractReader.UserInfoLight","name":"user","type":"tuple"}],"internalType":"struct ContractReader.VaultWithUserInfoLight[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"address[]","name":"_vaults","type":"address[]"}],"name":"vaultWithUserInfos","outputs":[{"components":[{"components":[{"internalType":"address","name":"addr","type":"address"},{"internalType":"string","name":"name","type":"string"},{"internalType":"uint256","name":"created","type":"uint256"},{"internalType":"bool","name":"active","type":"bool"},{"internalType":"uint256","name":"tvl","type":"uint256"},{"internalType":"uint256","name":"tvlUsdc","type":"uint256"},{"internalType":"uint256","name":"decimals","type":"uint256"},{"internalType":"address","name":"underlying","type":"address"},{"internalType":"address[]","name":"rewardTokens","type":"address[]"},{"internalType":"uint256[]","name":"rewardTokensBal","type":"uint256[]"},{"internalType":"uint256[]","name":"rewardTokensBalUsdc","type":"uint256[]"},{"internalType":"uint256","name":"duration","type":"uint256"},{"internalType":"uint256[]","name":"rewardsApr","type":"uint256[]"},{"internalType":"uint256","name":"ppfsApr","type":"uint256"},{"internalType":"uint256","name":"users","type":"uint256"},{"internalType":"address","name":"strategy","type":"address"},{"internalType":"uint256","name":"strategyCreated","type":"uint256"},{"internalType":"enum IStrategy.Platform","name":"platform","type":"uint8"},{"internalType":"address[]","name":"assets","type":"address[]"},{"internalType":"address[]","name":"strategyRewards","type":"address[]"},{"internalType":"bool","name":"strategyOnPause","type":"bool"},{"internalType":"uint256","name":"earned","type":"uint256"}],"internalType":"struct ContractReader.VaultInfo","name":"vault","type":"tuple"},{"components":[{"internalType":"address","name":"wallet","type":"address"},{"internalType":"address","name":"vault","type":"address"},{"internalType":"uint256","name":"underlyingBalance","type":"uint256"},{"internalType":"uint256","name":"underlyingBalanceUsdc","type":"uint256"},{"internalType":"uint256","name":"depositedUnderlying","type":"uint256"},{"internalType":"uint256","name":"depositedUnderlyingUsdc","type":"uint256"},{"internalType":"uint256","name":"depositedShare","type":"uint256"},{"internalType":"address[]","name":"rewardTokens","type":"address[]"},{"internalType":"uint256[]","name":"rewards","type":"uint256[]"},{"internalType":"uint256[]","name":"rewardsUsdc","type":"uint256[]"},{"internalType":"uint256[]","name":"rewardsEarned","type":"uint256[]"}],"internalType":"struct ContractReader.UserInfo","name":"user","type":"tuple"}],"internalType":"struct ContractReader.VaultWithUserInfo[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"address[]","name":"_vaults","type":"address[]"}],"name":"vaultWithUserInfosLight","outputs":[{"components":[{"components":[{"internalType":"address","name":"addr","type":"address"},{"internalType":"uint256","name":"created","type":"uint256"},{"internalType":"bool","name":"active","type":"bool"},{"internalType":"uint256","name":"tvl","type":"uint256"},{"internalType":"uint256","name":"tvlUsdc","type":"uint256"},{"internalType":"address","name":"underlying","type":"address"},{"internalType":"address[]","name":"rewardTokens","type":"address[]"},{"internalType":"uint256[]","name":"rewardsApr","type":"uint256[]"},{"internalType":"uint256","name":"ppfsApr","type":"uint256"},{"internalType":"enum IStrategy.Platform","name":"platform","type":"uint8"},{"internalType":"address[]","name":"assets","type":"address[]"},{"internalType":"uint256","name":"earned","type":"uint256"}],"internalType":"struct ContractReader.VaultInfoLight","name":"vault","type":"tuple"},{"components":[{"internalType":"uint256","name":"depositedUnderlying","type":"uint256"},{"internalType":"uint256","name":"depositedUnderlyingUsdc","type":"uint256"},{"internalType":"uint256","name":"depositedShare","type":"uint256"}],"internalType":"struct ContractReader.UserInfoLight","name":"user","type":"tuple"}],"internalType":"struct ContractReader.VaultWithUserInfoLight[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"vaults","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"vaultsLength","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}];
const BOOKKEEPER_ABI = [{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"token","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"RegisterFundKeeperEarned","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"vault","type":"address"},{"indexed":false,"internalType":"uint256","name":"oldValue","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"newValue","type":"uint256"}],"name":"RegisterPpfsChange","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"value","type":"address"}],"name":"RegisterStrategy","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"strategy","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"RegisterStrategyEarned","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"bool","name":"deposit","type":"bool"}],"name":"RegisterUserAction","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"address","name":"vault","type":"address"},{"indexed":false,"internalType":"address","name":"token","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"RegisterUserEarned","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"value","type":"address"}],"name":"RegisterVault","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"value","type":"address"}],"name":"RemoveStrategy","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"value","type":"address"}],"name":"RemoveVault","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"oldValue","type":"address"},{"indexed":false,"internalType":"address","name":"newValue","type":"address"}],"name":"UpdateController","type":"event"},{"inputs":[],"name":"VERSION","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"_strategies","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"_vaults","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_strategy","type":"address"}],"name":"addStrategy","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"}],"name":"addVault","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_vault","type":"address"},{"internalType":"address","name":"_strategy","type":"address"}],"name":"addVaultAndStrategy","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"controller","outputs":[{"internalType":"address","name":"adr","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"created","outputs":[{"internalType":"uint256","name":"ts","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"fundKeeperEarned","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_controller","type":"address"}],"name":"initialize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_controller","type":"address"}],"name":"initializeControllable","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_adr","type":"address"}],"name":"isController","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_adr","type":"address"}],"name":"isGovernance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"vault","type":"address"}],"name":"lastHardWork","outputs":[{"components":[{"internalType":"address","name":"strategy","type":"address"},{"internalType":"uint256","name":"block","type":"uint256"},{"internalType":"uint256","name":"time","type":"uint256"},{"internalType":"uint256","name":"targetTokenAmount","type":"uint256"}],"internalType":"struct IBookkeeper.HardWork","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"vault","type":"address"}],"name":"lastPpfsChange","outputs":[{"components":[{"internalType":"address","name":"vault","type":"address"},{"internalType":"uint256","name":"block","type":"uint256"},{"internalType":"uint256","name":"time","type":"uint256"},{"internalType":"uint256","name":"value","type":"uint256"},{"internalType":"uint256","name":"oldBlock","type":"uint256"},{"internalType":"uint256","name":"oldTime","type":"uint256"},{"internalType":"uint256","name":"oldValue","type":"uint256"}],"internalType":"struct IBookkeeper.PpfsChange","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_token","type":"address"},{"internalType":"uint256","name":"_fundTokenAmount","type":"uint256"}],"name":"registerFundKeeperEarned","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"vault","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"registerPpfsChange","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_targetTokenAmount","type":"uint256"}],"name":"registerStrategyEarned","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"uint256","name":"_amount","type":"uint256"},{"internalType":"bool","name":"_deposit","type":"bool"}],"name":"registerUserAction","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"address","name":"_vault","type":"address"},{"internalType":"address","name":"_rt","type":"address"},{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"registerUserEarned","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"registerVaultTransfer","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"removeFromStrategies","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"removeFromVaults","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"strategies","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"strategiesLength","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"targetTokenEarned","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"address","name":"","type":"address"},{"internalType":"address","name":"","type":"address"}],"name":"userEarned","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"address","name":"","type":"address"}],"name":"vaultUsersBalances","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"vaultUsersQuantity","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"vaults","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"vaultsLength","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}];

const CONTRACT_READER_ADDR = "0xCa9C8Fba773caafe19E6140eC0A7a54d996030Da";
const BOOKKEEPER_ADDR = "0x0A0846c978a56D6ea9D2602eeb8f977B21F3207F";
const INFO_BATCH_SIZE = 2;
const REQUEST_BATCH_SIZE = 30;

async function main() {
    const App = await init_ethers();

    _print(`Initialized ${App.YOUR_ADDRESS}\n`);
    _print("Reading smart contracts...\n");

    const bookkeeper = new ethers.Contract(BOOKKEEPER_ADDR, BOOKKEEPER_ABI,
        App.provider);
    const cReader = new ethers.Contract(CONTRACT_READER_ADDR,
        CONTRACT_READER_ABI, App.provider);

    const vaultCount = parseInt(await bookkeeper.vaultsLength(), 10);

    _print(`Found ${vaultCount} vaults.\n`);
    _print(`Showing active vaults only.\n`);

    const requests = [];
    for (let i = 0; i <= Math.floor(vaultCount / INFO_BATCH_SIZE); i++) {
        console.log('req', i, INFO_BATCH_SIZE);
        requests.push(
            cReader.vaultWithUserInfoPages(App.YOUR_ADDRESS, i, INFO_BATCH_SIZE)
        );
    }

    let infos = [];
    for (let i = 0; i <= Math.floor(requests.length / REQUEST_BATCH_SIZE); i++) {
        sleep(1000);
        infos.push(...(await Promise.allSettled(
            requests.slice(
                i * REQUEST_BATCH_SIZE,
                i * REQUEST_BATCH_SIZE + REQUEST_BATCH_SIZE
            )
        )));
    }
    infos = infos.map((l) => l.value)
    .filter((l) => !!l)
    .map((l) => l[0]);

    for (let info of infos) {
        printInfo(info.vault, info.user);
    }

    _print("Finished reading smart contracts.\n");

    hideLoading();
}

function printInfo(vaultInfo, userInfo) {
    if (vaultInfo.active === false) {
        return;
    }
    const url = 'https://polygonscan.com/address/';

    let apr = parseInt(vaultInfo.ppfsApr, 10) / 1e18;

    for (let rewardTokenApr of vaultInfo.rewardsApr) {
        apr += (parseInt(rewardTokenApr, 10) / 1e18)
    }
    const deposited = parseInt(userInfo.depositedUnderlyingUsdc, 10) / 1e18;

    _print(
        `<a href='${url}${vaultInfo.addr}' target='_blank'>${vaultInfo.name}</a>`);
    _print(`TVL: $${formatMoney(parseInt(vaultInfo.tvlUsdc, 10) / 1e18)}`);
    _print(`APR: ${apr.toFixed(2)}%`);

    if (deposited !== 0) {
        _print(`Balance: $${formatMoney(deposited)}`);
    }
    _print('');

}
