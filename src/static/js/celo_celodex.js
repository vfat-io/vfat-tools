
$(function () {
  consoleInit(main)
});

const POLYDEX_CHEF_ABI = [{ "type": "event", "name": "Commission", "inputs": [{ "type": "address", "name": "account", "internalType": "address", "indexed": false }, { "type": "address", "name": "referrer", "internalType": "address", "indexed": false }, { "type": "uint256", "name": "commission", "internalType": "uint256", "indexed": false }], "anonymous": false }, { "type": "event", "name": "Deposit", "inputs": [{ "type": "address", "name": "user", "internalType": "address", "indexed": true }, { "type": "uint256", "name": "pid", "internalType": "uint256", "indexed": true }, { "type": "uint256", "name": "amount", "internalType": "uint256", "indexed": false }], "anonymous": false }, { "type": "event", "name": "EmergencyWithdraw", "inputs": [{ "type": "address", "name": "user", "internalType": "address", "indexed": true }, { "type": "uint256", "name": "pid", "internalType": "uint256", "indexed": true }, { "type": "uint256", "name": "amount", "internalType": "uint256", "indexed": false }], "anonymous": false }, { "type": "event", "name": "LogRewardPerSecond", "inputs": [{ "type": "uint256", "name": "rewardPerSecond", "internalType": "uint256", "indexed": false }], "anonymous": false }, { "type": "event", "name": "OwnershipTransferred", "inputs": [{ "type": "address", "name": "previousOwner", "internalType": "address", "indexed": true }, { "type": "address", "name": "newOwner", "internalType": "address", "indexed": true }], "anonymous": false }, { "type": "event", "name": "RewardPaid", "inputs": [{ "type": "address", "name": "user", "internalType": "address", "indexed": true }, { "type": "uint256", "name": "amount", "internalType": "uint256", "indexed": false }], "anonymous": false }, { "type": "event", "name": "StrategyUpdated", "inputs": [{ "type": "uint256", "name": "pid", "internalType": "uint256", "indexed": true }, { "type": "address", "name": "oldStrategy", "internalType": "address", "indexed": false }, { "type": "address", "name": "newStrategy", "internalType": "address", "indexed": false }], "anonymous": false }, { "type": "event", "name": "TimelockUpdated", "inputs": [{ "type": "address", "name": "newTimelock", "internalType": "address", "indexed": false }], "anonymous": false }, { "type": "event", "name": "Withdraw", "inputs": [{ "type": "address", "name": "user", "internalType": "address", "indexed": true }, { "type": "uint256", "name": "pid", "internalType": "uint256", "indexed": true }, { "type": "uint256", "name": "amount", "internalType": "uint256", "indexed": false }], "anonymous": false }, { "type": "event", "name": "WithdrawFee", "inputs": [{ "type": "address", "name": "user", "internalType": "address", "indexed": true }, { "type": "uint256", "name": "pid", "internalType": "uint256", "indexed": true }, { "type": "uint256", "name": "amount", "internalType": "uint256", "indexed": false }, { "type": "uint256", "name": "fee", "internalType": "uint256", "indexed": false }], "anonymous": false }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "addPool", "inputs": [{ "type": "uint256", "name": "_allocPoint", "internalType": "uint256" }, { "type": "address", "name": "_lpToken", "internalType": "contract IERC20" }, { "type": "uint16", "name": "_depositFeeBP", "internalType": "uint16" }, { "type": "uint256", "name": "_lastRewardTime", "internalType": "uint256" }, { "type": "uint256", "name": "_lockedTime", "internalType": "uint256" }, { "type": "uint256", "name": "_earlyWithdrawFee", "internalType": "uint256" }] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "bool", "name": "", "internalType": "bool" }], "name": "approvedStrategies", "inputs": [{ "type": "address", "name": "", "internalType": "address" }] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "address", "name": "", "internalType": "address" }], "name": "clx", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "commissionPercent", "inputs": [] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "deposit", "inputs": [{ "type": "uint256", "name": "_pid", "internalType": "uint256" }, { "type": "uint256", "name": "_amount", "internalType": "uint256" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "depositWithRef", "inputs": [{ "type": "uint256", "name": "_pid", "internalType": "uint256" }, { "type": "uint256", "name": "_amount", "internalType": "uint256" }, { "type": "address", "name": "_referrer", "internalType": "address" }] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "address", "name": "", "internalType": "address" }], "name": "devFund", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "devRate", "inputs": [] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "emergencyWithdraw", "inputs": [{ "type": "uint256", "name": "_pid", "internalType": "uint256" }] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "endReleaseTime", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "bool", "name": "", "internalType": "bool" }], "name": "halvingChecked", "inputs": [] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "harvestAllRewards", "inputs": [] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "initialize", "inputs": [{ "type": "address", "name": "_clx", "internalType": "address" }, { "type": "address", "name": "_locker", "internalType": "address" }, { "type": "address", "name": "_treasuryFund", "internalType": "address" }, { "type": "uint256", "name": "_rewardPerSecond", "internalType": "uint256" }, { "type": "uint256", "name": "_totalRewardPerSecond", "internalType": "uint256" }, { "type": "uint256", "name": "_startTime", "internalType": "uint256" }] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "lockPercent", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "address", "name": "", "internalType": "address" }], "name": "locker", "inputs": [] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "massUpdatePools", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "nextHalvingTime", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "address", "name": "", "internalType": "address" }], "name": "owner", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "pendingReward", "inputs": [{ "type": "uint256", "name": "_pid", "internalType": "uint256" }, { "type": "address", "name": "_user", "internalType": "address" }] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "address", "name": "lpToken", "internalType": "contract IERC20" }, { "type": "uint256", "name": "allocPoint", "internalType": "uint256" }, { "type": "uint256", "name": "lastRewardTime", "internalType": "uint256" }, { "type": "uint256", "name": "accClxPerShare", "internalType": "uint256" }, { "type": "uint256", "name": "totalLpSupply", "internalType": "uint256" }, { "type": "bool", "name": "isStarted", "internalType": "bool" }, { "type": "uint256", "name": "startTime", "internalType": "uint256" }, { "type": "uint16", "name": "depositFeeBP", "internalType": "uint16" }, { "type": "uint256", "name": "lockedTime", "internalType": "uint256" }, { "type": "uint256", "name": "earlyWithdrawFee", "internalType": "uint256" }], "name": "poolInfo", "inputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "poolLength", "inputs": [] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "renounceOwnership", "inputs": [] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "replacePoolLpToken", "inputs": [{ "type": "uint256", "name": "_pid", "internalType": "uint256" }, { "type": "address", "name": "_lpToken", "internalType": "contract IERC20" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "rescueStuckErc20", "inputs": [{ "type": "address", "name": "_token", "internalType": "address" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "resetStartTime", "inputs": [{ "type": "uint256", "name": "_startTime", "internalType": "uint256" }] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "rewardHalvingRate", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "rewardPerSecond", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "address", "name": "", "internalType": "address" }], "name": "rewardReferral", "inputs": [] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "setCommissionPercent", "inputs": [{ "type": "uint256", "name": "_commissionPercent", "internalType": "uint256" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "setDevFund", "inputs": [{ "type": "address", "name": "_devFund", "internalType": "address" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "setDevRate", "inputs": [{ "type": "uint256", "name": "_devRate", "internalType": "uint256" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "setHalvingChecked", "inputs": [{ "type": "bool", "name": "_halvingChecked", "internalType": "bool" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "setLockPercent", "inputs": [{ "type": "uint256", "name": "_lockPercent", "internalType": "uint256" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "setPool", "inputs": [{ "type": "uint256", "name": "_pid", "internalType": "uint256" }, { "type": "uint256", "name": "_allocPoint", "internalType": "uint256" }, { "type": "uint16", "name": "_depositFeeBP", "internalType": "uint16" }, { "type": "uint256", "name": "_lockedTime", "internalType": "uint256" }, { "type": "uint256", "name": "_earlyWithdrawFee", "internalType": "uint256" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "setPoolStartTime", "inputs": [{ "type": "uint256", "name": "_pid", "internalType": "uint256" }, { "type": "uint256", "name": "_lastRewardTime", "internalType": "uint256" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "setRewardHalvingRate", "inputs": [{ "type": "uint256", "name": "_rewardHalvingRate", "internalType": "uint256" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "setRewardReferral", "inputs": [{ "type": "address", "name": "_rewardReferral", "internalType": "address" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "setTimelock", "inputs": [{ "type": "address", "name": "_timelock", "internalType": "address" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "setTotalRewardPerSecond", "inputs": [{ "type": "uint256", "name": "_totalRewardPerSecond", "internalType": "uint256" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "setTreasuryFund", "inputs": [{ "type": "address", "name": "_treasuryFund", "internalType": "address" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "setTreasuryRate", "inputs": [{ "type": "uint256", "name": "_treasuryRate", "internalType": "uint256" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "setWhitelistedContract", "inputs": [{ "type": "address", "name": "_contract", "internalType": "address" }, { "type": "bool", "name": "_isWhitelisted", "internalType": "bool" }] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "startReleaseTime", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "startTime", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "address", "name": "", "internalType": "address" }], "name": "timelock", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "totalAllocPoint", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "totalDevFundAdded", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "totalRewardPerSecond", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "totalTreasuryFundAdded", "inputs": [] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "transferOwnership", "inputs": [{ "type": "address", "name": "newOwner", "internalType": "address" }] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "address", "name": "", "internalType": "address" }], "name": "treasuryFund", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "treasuryRate", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "unfrozenDepositTime", "inputs": [{ "type": "uint256", "name": "_pid", "internalType": "uint256" }, { "type": "address", "name": "_account", "internalType": "address" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "updatePool", "inputs": [{ "type": "uint256", "name": "_pid", "internalType": "uint256" }] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "amount", "internalType": "uint256" }, { "type": "uint256", "name": "rewardDebt", "internalType": "uint256" }], "name": "userInfo", "inputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }, { "type": "address", "name": "", "internalType": "address" }] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "userLastDepositTime", "inputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }, { "type": "address", "name": "", "internalType": "address" }] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "uint256", "name": "", "internalType": "uint256" }], "name": "week", "inputs": [] }, { "type": "function", "stateMutability": "view", "outputs": [{ "type": "bool", "name": "", "internalType": "bool" }], "name": "whitelistedContract", "inputs": [{ "type": "address", "name": "", "internalType": "address" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "withdraw", "inputs": [{ "type": "uint256", "name": "_pid", "internalType": "uint256" }, { "type": "uint256", "name": "_amount", "internalType": "uint256" }] }, { "type": "function", "stateMutability": "nonpayable", "outputs": [], "name": "withdrawAll", "inputs": [{ "type": "uint256", "name": "_pid", "internalType": "uint256" }] }]

async function main() {

  const App = await init_ethers();

  _print(`Initialized ${App.YOUR_ADDRESS}\n`);
  _print("Reading smart contracts...\n");

  let prices = await getCeloPrices();

  const CELODEX_CHEF_ADDR = "0x20186B0D87bb187e1a11366288607128C4C92761";
  const CLX_ADDR = '0xC7144Fa865c9f3a6836167A51531A2CC8b0ab5fD';
  const CLX_USD_ADDRESS = "0x9E51605EBd0682EF7ee16042a8037cc27d1B5828";//CLX/cUSD LP CELODEX

  const rewardTokenTicker = "CLX";

  const chefContract = new ethers.Contract(CELODEX_CHEF_ADDR, POLYDEX_CHEF_ABI, App.provider);

  const lpToken = await getCeloToken(App, CLX_USD_ADDRESS, CELODEX_CHEF_ADDR);
  const index =  lpToken.token0 === CLX_ADDR ? 1 : 0;
  const basePrice = prices[lpToken.tokens[index]] || {usd: 1};
  const clxPrice =  lpToken["q" + index] / lpToken["q" + (index === 0 ? 1 : 0)] * basePrice.usd;

  prices[CLX_ADDR] = { usd: clxPrice }


  let rewardsPerWeek = await chefContract.rewardPerSecond() / 1e18 * 604800;

  const tokens = {};

  await loadCeloChefContract(App, tokens, prices, chefContract, CELODEX_CHEF_ADDR, POLYDEX_CHEF_ABI, rewardTokenTicker,
    "clx", null, rewardsPerWeek, "pendingReward",[], []);

  hideLoading();
}

